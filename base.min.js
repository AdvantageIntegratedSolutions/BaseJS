function BaseConnect(e){this.config=e,this.inverseTables=BaseHelpers.inverseTables(e.tables),this.apptoken=e.token,this.async=e.async||!1,this.databaseId=e.databaseId,this.serverSide=e.serverSide||!1,this.realm=e.realm,this.post=function(e,t,n){var a=e.type||"API",i=a+"_"+e.action,r=this.buildPostData(e.dbid,e),s="";return s=e.dbid?this.config&&"main"!=e.dbid?e.dbid==this.databaseId?this.databaseId:this.config.tables[e.dbid].dbid:e.dbid:this.databaseId,this.xmlPost(s,i,r,t,n)},this.generateQuickbaseQuery=function(e){var t=[],n=function(e,t){return"{'"+e+"'.EX.'"+t+"'}"},a=function(e,t){for(var n=Object.keys(t),a=[],i=0;i<n.length;i++){var r=n[i],s=t[r],o="";if("in"==r){var a=[];s.forEach(function(t){a.push("{'"+e+"'.EX.'"+t+"'}")}),o="("+a.join("OR")+")"}else o="{'"+e+"'."+r+".'"+s+"'}";a.push(o)}return a.join("AND")},i=function(e,t){var i=[];return t.forEach(function(e){var t=Object.keys(e)[0],r=e[t];if("object"==typeof r){var e=a(t,r);i.push(e)}else{var e=n(t,r);i.push(e)}}),"("+i.join("OR")+")"};for(key in e){var r=e[key],s="";s="or"==key?i(key,r):"object"==typeof r?a(key,r):n(key,e[key]),t.push(s)}return t=t.join("AND")},this.replaceFieldNames=function(e,t){var n=this.config;return e=e.split(/(AND|OR)/).map(function(e){if("AND"!=e&&"OR"!=e){var a=e.match(/\{'*(.*)'\..*'/)[1];if(isNaN(a)){var i=n.tables[t][a];e=e.replace(a,i)}}return e}),e.join("")},this.replaceOptionFieldNames=function(e,t){var n=this.config;return e=e.split("."),e=e.map(function(e){if(isNaN(e)){var a=n.tables[t][e];return a}return e}),e.join(".")},this.handleXMLCharacters=function(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},this.buildPostData=function(e,t){var n=["<qdbapi>"];this.apptoken&&n.push(this.createParameter("apptoken",this.apptoken));for(key in t.params){var a=t.params[key];"clist"==key||"slist"==key||"options"==key?("object"==typeof a&&(a=a.join(".")),!this.config||"clist"!=key&&"slist"!=key||a&&(a=this.replaceOptionFieldNames(a,e))):"query"==key&&(a=this.generateQuickbaseQuery(a),this.config&&(a=this.replaceFieldNames(a,e)),key="query"),a&&n.push(this.createParameter(key,a))}for(field in t.fieldParams){if(this.config)var i=this.config.tables[e][field];else var i=field;var r=this.handleXMLCharacters(t.fieldParams[field]);n.push(this.createFieldParameter(i,r))}for(key in t.fidParams)n.push(this.createFidParameter(key,t.fidParams[key]));return t.csvData&&n.push(this.createCSVParameter(t.csvData)),n.push("</qdbapi>"),n=n.join(""),this.serverSide?{xml:n}:n},this.getNode=function(e,t){return $(e).find(t).text()},this.getRecords=function(e,t){for(var n=$(t).find("records").find("record"),a=[],i=0;i<n.length;i++){var r=n[i],s=$(r).find("f");r={};for(var o=0;o<s.length;o++){var d=s[o],h=parseInt($(d).attr("id"));if(""!=$(d).find("url").text())var c=$(d).find("url").text(),u=c.split("/"),l=u[u.length-1],f={filename:l,url:c};else var f=$(d).text();if(this.config){var p=this.inverseTables[e];p[h]&&(h=p[h.toString()],r[h]=f)}else r[h]=f}a.push(r)}return a},this.getRids=function(e){for(var t=$(e).find("records").find("record"),n=[],a=0;a<t.length;a++){var i=t[a];n.push($(i).find('f[id="3"]').text())}return n},this.getNewRids=function(e){for(var t=$(e).find("rids").find("rid"),n=[],a=0;a<t.length;a++){var i=parseInt($(t[a]).text());n.push(i)}return n},this.getFields=function(e){for(var t=$(e).find("fields").find("field"),n={},a=0;a<t.length;a++){var i=t[a],r={label:$(i).find("label").text(),nowrap:$(i).find("nowrap").text(),bold:$(i).find("bold").text(),required:$(i).find("required").text(),appears_by_default:$(i).find("appears_by_default").text(),find_enabled:$(i).find("find_enabled").text(),allow_new_choices:$(i).find("allow_new_choices").text(),sort_as_given:$(i).find("sort_as_given").text(),carrychoices:$(i).find("carrychoices").text(),foreignkey:$(i).find("foreignkey").text(),unique:$(i).find("unique").text(),doesdatacopy:$(i).find("doesdatacopy").text(),fieldhelp:$(i).find("fieldhelp").text(),display_user:$(i).find("display_user").text(),default_kind:$(i).find("default_kind").text()},s=$(i).find("choices").find("choice");if(s.length>0){for(var o=[],d=0;d<s.length;d++){var h=$(s[d]).text();o.push(h)}r.choices=o}n[$(i).attr("id")]=r}return n},this.getReports=function(e){for(var t=$(e).find("queries").find("query"),n={},a=0;a<t.length;a++){var i=t[a],r={name:$(i).find("qyname").text(),type:$(i).find("qytype").text(),criteria:$(i).find("qycrit").text(),clist:$(i).find("qyclst").text(),slist:$(i).find("qyslst").text(),options:$(i).find("qyopts").text()};n[$(i).attr("id")]=r}return n},this.formatUserRoles=function(e){for(var t=$(e).find("users").find("user"),n=[],a=0;a<t.length;a++){for(var i=t[a],r=$(i).find("roles").find("role"),s=[],o=0;o<r.length;o++){var d=r[o],h={id:$(d).attr("id"),name:$(d).find("name").text(),accessId:$(d).find("access").attr("id"),access:$(d).find("access").text()};s.push(h)}var c={id:$(i).attr("id"),firstName:$(i).find("firstName").text(),lastName:$(i).find("lastName").text(),lastAccess:$(i).find("lastAccess").text(),lastAccessAppLocal:$(i).find("lastAccessAppLocal").text(),roles:s};n.push(c)}return n},this.createParameter=function(e,t){return"<"+e+">"+t+"</"+e+">"},this.createFieldParameter=function(e,t){var n="<field fid='"+e+"'";return t?t.filename?(n+=" filename='"+t.filename+"'>",n+=this.base64Encode(t.body)):(n+=">",n+=t):n+=">",n+="</field>"},this.createFidParameter=function(e,t){return"<_fid_"+e+">"+t+"</_fid_"+e+">"},this.createCSVParameter=function(e){return"<records_csv><![CDATA["+e+"]]></records_csv>"},this.base64Encode=function(e){for(var t,n,a,i,r,s,o,d="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=e.replace(/\r\n/g,"\n"),l="",f=0;f<u.length;f++){var p=u.charCodeAt(f);128>p?l+=String.fromCharCode(p):p>127&&2048>p?(l+=String.fromCharCode(p>>6|192),l+=String.fromCharCode(63&p|128)):(l+=String.fromCharCode(p>>12|224),l+=String.fromCharCode(p>>6&63|128),l+=String.fromCharCode(63&p|128))}for(e=l;c<e.length;)t=e.charCodeAt(c++),n=e.charCodeAt(c++),a=e.charCodeAt(c++),i=t>>2,r=(3&t)<<4|n>>4,s=(15&n)<<2|a>>6,o=63&a,isNaN(n)?s=o=64:isNaN(a)&&(o=64),d=d+h.charAt(i)+h.charAt(r)+h.charAt(s)+h.charAt(o);return d},this.xmlPost=function(e,t,n,a,i){var r="/db/"+e+"?act="+t,s={url:r,data:n,dataType:"xml",type:"POST",context:this};if(this.serverSide?(n.realm=this.realm,n.url=r,n.call=t,n.apptoken=this.apptoken,s.dataType="text",s.data=n,s.url="https://link.advantagesoftware.net/basejs/submit"):s.contentType="text/xml","callback"!=this.async){if("promise"==this.async)return s.dataType="text",s.dataFilter=i,$.ajax(s);var o=null;return s.success=function(e){o=i(e)},s.async=!1,$.ajax(s),o}s.contentType="text/xml",s.success=function(e){return a(i(e))},$.ajax(s)},this.parseResponse=function(e){var t=this.getNode(e,"errcode");return"0"!=t&&console.log("*****ERROR*****: ("+this.getNode(e,"action")+")(CODE: "+t+")","MESSAGE: "+this.getNode(e,"errtext")+" - "+this.getNode(e,"errdetail")),this.ticket=this.getNode(e,"ticket"),e},this.initHttpConnection=function(e){var t=null;this.context=e;try{t||(t=new XMLHttpRequest)}catch(n){}try{t||(t=new ActiveXObject("Msxml2.XMLHTTP"))}catch(n){}try{t||(t=new ActiveXObject("Microsoft.XMLHTTP"))}catch(n){alert("This browser does not support BaseJS.")}return t}}function Base(e){var t=new BaseConnect(e);this.databaseId=e.databaseId,this.Table=function(e,n){this[e]=n,this.tableName=e,this.dbid=n.dbid,this.doQuery=function(n,a,i,r){var s=this.tableName;this.handle=function(e){return t.getRecords(s,e,"records")};var o={fmt:"structured"};if(n){var d=!isNaN(n);d?o.qid=n:o.query=n}else o.query="{'3'.XEX.''}";if(a)var h=a.clist;else var a={};if(t.config&&!h){var c=t.config.tables[s],h=[];for(e in c){var u=c[e];isNaN(u)||h.push(e)}a.clist=h.join(".")}o.clist=a.clist,o.slist=a.slist,o.options=a.options;var l={dbid:s,action:"DoQuery",params:o};return r&&(this.handle=r),t.post(l,i,this.handle)},this.find=function(e,n){var a=this.tableName;if(this.handle=function(e){var n=t.getRecords(a,e,"records");return n.length>0?n.length>1?n:n[0]:{}},"[object Array]"==Object.prototype.toString.call(e))var i={3:{"in":e}};else var i={3:e};return this.doQuery(i,null,n,this.handle)},this.first=function(e,n,a){var i=this.tableName;return this.handle=function(e){var n=t.getRecords(i,e,"records");return n.length>0?n[0]:{}},this.doQuery(e,n,a,this.handle)},this.last=function(e,n,a){var i=this.tableName;return this.handle=function(e){var n=t.getRecords(i,e,"records");return n.length>0?n[n.length-1]:{}},this.doQuery(e,n,a,this.handle)},this.all=function(e,n){var a=this.tableName;return this.handle=function(e){var n=t.getRecords(a,e,"records");return n.length>0?n:{}},this.doQuery({3:{XEX:""}},e,n,this.handle)},this.getRids=function(e,n){return this.handle=function(e){return t.getRids(e)},params={clist:"3"},e||(e={3:{XEX:""}}),this.doQuery(e,params,n,this.handle)},this.doQueryCount=function(e,n){this.handle=function(e){return t.getNode(e,"numMatches")};var a={dbid:this.tableName,action:"DoQueryCount",params:{query:e}};return t.post(a,n,this.handle)},this.addRecord=function(e,n){this.handle=function(e){return parseInt(t.getNode(e,"rid"))};var a={dbid:this.tableName,action:"AddRecord",fieldParams:e};return t.post(a,n,this.handle)},this.editRecord=function(e,n,a){this.handle=function(e){var n=t.getNode(e,"rid");return n?!0:!1};var i={dbid:this.tableName,action:"EditRecord",fieldParams:n,params:{rid:e}};return t.post(i,a,this.handle)},this.changeRecordOwner=function(e,n,a){this.handle=function(){return!0};var i={dbid:this.tableName,action:"ChangeRecordOwner",params:{rid:e,newowner:n}};return t.post(i,a,this.handle)},this.copyMasterDetail=function(e,n){this.handle=function(e){return t.getNode(e,"numCreated")};var a={dbid:this.tableName,action:"CopyMasterDetail",params:e};return t.post(a,n,this.handle)},this.getRecordInfo=function(e,n){this.handle=function(e){for(var n={},a=$(e).find("field"),i=0;i<a.length;i++){var r=a[i],s={name:t.getNode(r,"name"),type:t.getNode(r,"type"),value:t.getNode(r,"value")};n[$(r).find("fid").text()]=s}var o={rid:t.getNode(e,"rid"),num_fields:t.getNode(e,"num_fields"),update_id:t.getNode(e,"update_id"),fields:n};return o};var a={dbid:this.tableName,action:"GetRecordInfo",params:{rid:e}};return t.post(a,n,this.handle)},this.deleteRecord=function(e,n){this.handle=function(e){var n=t.getNode(e,"rid");return n?!0:!1};var a={dbid:this.tableName,action:"DeleteRecord",params:{rid:e}};return t.post(a,n,this.handle)},this.purgeRecords=function(e,n){this.handle=function(e){var n=t.getNode(e,"num_records_deleted");return parseInt(n)};var a={dbid:this.tableName,action:"PurgeRecords",params:{query:e}};return t.post(a,n,this.handle)},this.importFromCSV=function(n,a){this.handle=function(e){return t.getNewRids(e)};var i="",r=[];for(e in n[0])t.config&&(tableConfig=t.config.tables[this.tableName],e=tableConfig[e]),r.push(e);r=r.join(".");for(var s=0;s<n.length;s++){var o=n[s],d=[];for(e in o)value=o[e],value=value.toString().replace(/"/g,'""'),d.push('"'+value+'"');d.join(","),d+="\n",i+=d}var h={dbid:this.tableName,action:"ImportFromCSV",params:{clist:r},csvData:i};return t.post(h,a,this.handle)},this.getTableFields=function(e){this.handle=function(e){return t.getFields(e)};var n={dbid:this.tableName,action:"GetSchema"};return t.post(n,e,this.handle)},this.genAddRecordForm=function(e,n){this.handle=function(e){return e};var a={dbid:this.tableName,action:"GenAddRecordForm",fidParams:e};return t.post(a,n,this.handle)},this.getNumRecords=function(e){this.handle=function(e){return parseInt(t.getNode(e,"num_records"))};var n={dbid:this.tableName,action:"GetNumRecords"};return t.post(n,e,this.handle)},this.setFieldProperties=function(e,n,a){this.handle=function(e){var n=t.getNode(e,"errcode");return 0==n?!0:!1},n.fid=e;var i={dbid:this.tableName,action:"SetFieldProperties",params:n};return t.post(i,a,this.handle)},this.getTableReports=function(e){this.handle=function(e){return t.getReports(e)};var n={dbid:this.tableName,action:"GetSchema"};return t.post(n,e,this.handle)}},this.setTables=function(e){for(key in e)this[key]=new this.Table(key,e[key])},this.setTables(e.tables),this.getOneTimeTicket=function(e){this.handle=function(e){return t.getNode(e,"ticket")};var n={action:"GetOneTimeTicket"};return t.post(n,e,this.handle)},this.authenticate=function(e,n,a){this.handle=function(e){return t.getNode(e,"ticket")};var i={action:"Authenticate",params:{ticket:e,hours:n}};return t.post(i,a,this.handle)},this.signOut=function(e){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var n={action:"SignOut"};return t.post(n,e,this.handle)},this.getDBVar=function(e,n){this.handle=function(e){return t.getNode(e,"value")};var a={dbid:this.databaseId,action:"GetDBvar",params:{varname:e}};return t.post(a,n,this.handle)},this.setDBVar=function(e,n,a){this.handle=function(){return!0};var i={dbid:this.databaseId,action:"SetDBvar",params:{varname:e,value:n}};return t.post(i,a,this.handle)},this.uploadPage=function(e,n,a,i){this.handle=function(e){return t.getNode(e,"pageID")};var r={pagetype:"1",pagebody:a};e?r.pageid=e:n&&(r.pagename=n);var s={dbid:this.databaseId,action:"AddReplaceDBPage",params:r};return t.post(s,i,this.handle)},this.deletePage=function(e,n){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var a={dbid:this.databaseId,action:"PageDelete",type:"QBI",params:{pageid:e}};return t.post(a,n,this.handle)},this.getDbPage=function(e,n){this.handle=function(e){return t.getNode(e,"pagebody")};var a={dbid:this.databaseId,action:"GetDBPage",type:"API",params:{pageID:e}};return t.post(a,n,this.handle)},this.cloneDatabase=function(e,n){this.handle=function(e){return t.getNode(e,"newdbid")};var a={dbid:this.databaseId,action:"CloneDatabase",type:"API",params:e};return t.post(a,n,this.handle)},this.createDatabase=function(e,n,a,i){this.handle=function(e){return t.getNode(e,"dbid")};var r={action:"CreateDatabase",type:"API",params:{dbname:e,dbdesc:n,createapptoken:a||!1}};return t.post(r,i,this.handle)},this.deleteDatabase=function(e){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var n={dbid:this.databaseId,action:"DeleteDatabase",type:"API"};return t.post(n,e,this.handle)},this.renameApp=function(e,n){this.handle=function(e){var n=t.getNode(e,"errcode");return"0"==n?!0:!1};var a={dbid:this.databaseId,action:"RenameApp",type:"API",params:{newappname:e}};return t.post(a,n,this.handle)},this.findDbByName=function(e,n){this.handle=function(e){return t.getNode(e,"dbid")};var a={action:"FindDBByName",type:"API",params:{dbname:e}};return t.post(a,n,this.handle)},this.getAppDtmInfo=function(e){this.handle=function(e){for(var n={},a=$(e).find("tables").find("table"),i=0;i<a.length;i++){var r=a[i],s={lastModifiedTime:$(r).find("lastModifiedTime").text(),lastRecModTime:$(r).find("lastRecModTime").text()};n[$(r).attr("id")]=s}var o={requestTime:t.getNode(e,"RequestTime"),requestNextAllowedTime:t.getNode(e,"RequestNextAllowedTime"),lastModifiedTime:t.getNode(e,"lastModifiedTime"),lastRecModTime:t.getNode(e,"lastRecModTime"),tables:n};return o};var n={action:"GetAppDTMInfo",type:"API",params:{dbid:this.databaseId}};return t.post(n,e,this.handle)},this.getDbInfo=function(e){this.handle=function(e){var n={dbname:t.getNode(e,"dbname"),lastRecModTime:t.getNode(e,"lastRecModTime"),createdTime:t.getNode(e,"createdTime"),numRecords:t.getNode(e,"numRecords"),mgrID:t.getNode(e,"mgrID"),mgrName:t.getNode(e,"mgrName"),version:t.getNode(e,"version"),time_zone:t.getNode(e,"time_zone")};return n};var n={dbid:this.databaseId,action:"GetDBInfo",type:"API"};return t.post(n,e,this.handle)},this.grantedDbs=function(e,n){this.handle=function(e){for(var n=[],a=$(e).find("databases").find("dbinfo"),i=0;i<a.length;i++){var r=a[i],s={dbname:t.getNode(r,"dbname"),dbid:t.getNode(r,"dbid")};n.push(s)}return n};var a={action:"GrantedDBs",type:"API",params:e};return t.post(a,n,this.handle)},this.getUserInfo=function(e,n){this.handle=function(e){var t=$(e).find("user");return t={id:$(t).attr("id"),firstName:$(t).find("firstName").text(),lastName:$(t).find("lastName").text(),login:$(t).find("login").text(),email:$(t).find("email").text(),screenName:$(t).find("screenName").text(),isVerified:$(t).find("isVerified").text(),externalAuth:$(t).find("externalAuth").text()}},e||(e="");var a={dbid:"main",action:"GetUserInfo",params:{email:e}};return t.post(a,n,this.handle)},this.getUserRoles=function(e){this.handle=function(e){return t.formatUserRoles(e)};var n={dbid:this.databaseId,action:"UserRoles"};return t.post(n,e,this.handle)},this.changeUserRole=function(e,n,a,i){this.handle=function(){return!0};var r={dbid:this.databaseId,action:"ChangeUserRole",params:{userId:e,roleId:n}};return a&&(r.params.newRoleId=a),t.post(r,i,this.handle)}}var BaseHelpers={options:{timeZone:"utc",format:"hours"},inverseTables:function(e){var t={};for(var n in e){var a={};for(var i in e[n])a[e[n][i].toString()]=i;t[n]=a}return t},getUrlParam:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},formatDateElement:function(e){return e=e.toString(),1==e.length&&(e="0"+e),e},dateToString:function(e){if(e){var t=new Date(parseInt(e)),n=this.formatDateElement(t.getUTCMonth()+1),a=this.formatDateElement(t.getUTCDate());return t=[n,a,t.getUTCFullYear()].join("-")}return" "},dateTimeToString:function(e,t){var n=new Date,t=t?t.toLowerCase().trim():this.options.timeZone.toLowerCase();Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};var a={utc:0,eastern:n.dst()?-4:-5,central:n.dst()?-5:-6,mountain:n.dst()?-6:-7,pacific:n.dst()?-7:-8},i=a[t];if(e){var r=new Date(parseInt(e)+36e5*i),s=(this.formatDateElement(r.getUTCFullYear),this.formatDateElement(r.getUTCMonth()+1)),o=this.formatDateElement(r.getUTCDate()),d=this.formatDateElement(r.getUTCHours()),h=this.formatDateElement(r.getUTCMinutes()),c=(this.formatDateElement(r.getUTCSeconds()),[s,o,r.getUTCFullYear()].join("-")),u=parseInt(d)>=12?"PM":"AM";return d%=12,d=d?d:12,c+=" ",c+=[d,h].join(":"),c+=" "+u}return""},durationToString:function(e,t){var n,a=parseInt(e),t=t?t.trim().toLowerCase():this.options.format.toLowerCase(),i={days:function(){return a/864e5},hours:function(){return a/36e5},minutes:function(){return a/6e4},seconds:function(){return a/1e3}};return e?(i[t]?n=i[t]():(n=i.hours(),console.log("The format parameter passed to BaseHelpers.durationToString() was incorrect. Using the format for 'hours' instead.")),n=Math.round(100*n)/100,n.toString()):""},timeOfDayToString:function(e){var t="";t=new Date,t.setHours(""),t.setMinutes(""),t.setSeconds(""),t.setMilliseconds(e);var n=t.getHours().toString(),a=t.getMinutes().toString(),i=n>12?"pm":"am";return n%=12,n=n?n:12,a=a.length>1?a:"0"+a,t=n+":"+a+" "+i},redirectToEditForm:function(e,t){window.location="/db/"+e+"?a=er&rid="+t},redirectToViewForm:function(e,t){window.location="/db/"+e+"?a=dr&rid="+t},downloadFile:function(e,t,n,a){var a=a||0;window.location="https://www.quickbase.com/up/"+e+"/a/r"+t+"/e"+n+"/v"+a}};