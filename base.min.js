function BaseConnect(){this.apptoken=null,this.async=null,this.post=function(t,e,n){var r=t.type||"API",i=r+"_"+t.action,a=this.buildPostData(t);return this.xmlPost(t.dbid,i,a,e,n)},this.buildPostData=function(t){var e=["<qdbapi>"];this.apptoken&&e.push(this.createParameter("apptoken",this.apptoken));for(key in t.params){var n=t.params[key];("clist"==key||"slist"==key||"options"==key)&&"[object Array]"==Object.prototype.toString.call(n)&&(n=n.join(".")),n&&e.push(this.createParameter(key,n))}for(key in t.fieldParams)e.push(this.createFieldParameter(key,t.fieldParams[key]));for(key in t.fidParams)e.push(this.createFidParameter(key,t.fidParams[key]));return t.csvData&&e.push(this.createCSVParameter(t.csvData)),e.push("</qdbapi>"),e.join("")},this.getNode=function(t,e){return $(t).find(e).text()},this.getRecords=function(t){for(var e=$(t).find("records").find("record"),n=[],r=0;r<e.length;r++){var i=e[r],a=$(i).find("f");i={};for(var o=0;o<a.length;o++){var s=a[o],d=parseInt($(s).attr("id"));if(""!=$(s).find("url").text())var c=$(s).find("url").text(),u=c.split("/"),h=u[u.length-1],l={filename:h,url:c};else var l=$(s).text();i[d]=l}n.push(i)}return n},this.getRids=function(t){for(var e=$(t).find("records").find("record"),n=[],r=0;r<e.length;r++){var i=e[r];n.push($(i).find('f[id="3"]').text())}return n},this.getNewRids=function(t){for(var e=$(t).find("rids").find("rid"),n=[],r=0;r<e.length;r++){var i=parseInt($(e[r]).text());n.push(i)}return n},this.getFields=function(t){for(var e=$(t).find("fields").find("field"),n={},r=0;r<e.length;r++){var i=e[r],a={label:$(i).find("label").text(),nowrap:$(i).find("nowrap").text(),bold:$(i).find("bold").text(),required:$(i).find("required").text(),appears_by_default:$(i).find("appears_by_default").text(),find_enabled:$(i).find("find_enabled").text(),allow_new_choices:$(i).find("allow_new_choices").text(),sort_as_given:$(i).find("sort_as_given").text(),carrychoices:$(i).find("carrychoices").text(),foreignkey:$(i).find("foreignkey").text(),unique:$(i).find("unique").text(),doesdatacopy:$(i).find("doesdatacopy").text(),fieldhelp:$(i).find("fieldhelp").text(),display_user:$(i).find("display_user").text(),default_kind:$(i).find("default_kind").text()};n[$(i).attr("id")]=a}return n},this.getReports=function(t){for(var e=$(t).find("queries").find("query"),n={},r=0;r<e.length;r++){var i=e[r],a={name:$(i).find("qyname").text(),type:$(i).find("qytype").text(),criteria:$(i).find("qycrit").text(),clist:$(i).find("qyclst").text(),slist:$(i).find("qyslst").text(),options:$(i).find("qyopts").text()};n[$(i).attr("id")]=a}return n},this.formatUserRoles=function(t){for(var e=$(t).find("users").find("user"),n=[],r=0;r<e.length;r++){for(var i=e[r],a=$(i).find("roles").find("role"),o=[],s=0;s<a.length;s++){var d=a[s],c={id:$(d).attr("id"),name:$(d).find("name").text(),accessId:$(d).find("access").attr("id"),access:$(d).find("access").text()};o.push(c)}var u={id:$(i).attr("id"),firstName:$(i).find("firstName").text(),lastName:$(i).find("lastName").text(),lastAccess:$(i).find("lastAccess").text(),lastAccessAppLocal:$(i).find("lastAccessAppLocal").text(),roles:o};n.push(u)}return n},this.createParameter=function(t,e){return"<"+t+">"+e+"</"+t+">"},this.createFieldParameter=function(t,e){var n="<field fid='"+t+"'";return e&&(e.filename?(n+=" filename='"+e.filename+"'>",n+=this.base64Encode(e.body)):(n+=">",n+=e)),n+="</field>"},this.createFidParameter=function(t,e){return"<_fid_"+t+">"+e+"</_fid_"+t+">"},this.createCSVParameter=function(t){return"<records_csv><![CDATA["+t+"]]></records_csv>"},this.base64Encode=function(t){for(var e,n,r,i,a,o,s,d="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,h=t.replace(/\r\n/g,"\n"),l="",f=0;f<h.length;f++){var p=h.charCodeAt(f);128>p?l+=String.fromCharCode(p):p>127&&2048>p?(l+=String.fromCharCode(p>>6|192),l+=String.fromCharCode(63&p|128)):(l+=String.fromCharCode(p>>12|224),l+=String.fromCharCode(p>>6&63|128),l+=String.fromCharCode(63&p|128))}for(t=l;u<t.length;)e=t.charCodeAt(u++),n=t.charCodeAt(u++),r=t.charCodeAt(u++),i=e>>2,a=(3&e)<<4|n>>4,o=(15&n)<<2|r>>6,s=63&r,isNaN(n)?o=s=64:isNaN(r)&&(s=64),d=d+c.charAt(i)+c.charAt(a)+c.charAt(o)+c.charAt(s);return d},this.xmlPost=function(t,e,n,r,i){var a="/db/"+t+"?act="+e;if(!this.async){var o=null;return $.ajax({url:a,type:"POST",context:this,contentType:"text/xml",data:n,dataType:"xml",async:!1,success:function(t){o=i(t)}}),o}$.ajax({url:a,type:"POST",context:this,contentType:"text/xml",data:n,dataType:"xml",success:function(t){return r(i(t))}})},this.parseResponse=function(t){var e=this.getNode(t,"errcode");return"0"!=e&&console.log("*****ERROR*****: ("+this.getNode(t,"action")+")(CODE: "+e+")","MESSAGE: "+this.getNode(t,"errtext")+" - "+this.getNode(t,"errdetail")),this.ticket=this.getNode(t,"ticket"),t},this.setVariables=function(t,e){this.apptoken=t,this.async=e||!1},this.initHttpConnection=function(t){var e=null;this.context=t;try{e||(e=new XMLHttpRequest)}catch(n){}try{e||(e=new ActiveXObject("Msxml2.XMLHTTP"))}catch(n){}try{e||(e=new ActiveXObject("Microsoft.XMLHTTP"))}catch(n){alert("This browser does not support BaseJS.")}return e}}function Base(t,e){var n=new BaseConnect;n.setVariables(t,e),this.getOneTimeTicket=function(t){this.handle=function(t){return n.getNode(t,"ticket")};var e={dbid:"main",action:"GetOneTimeTicket"};return n.post(e,t,this.handle)},this.authenticate=function(t,e,r){this.handle=function(t){return n.getNode(t,"ticket")};var i={dbid:"main",action:"Authenticate",params:{ticket:t,hours:e}};return n.post(i,r,this.handle)},this.signOut=function(t){this.handle=function(t){var e=n.getNode(t,"errcode");return"0"==e?!0:!1};var e={dbid:"main",action:"SignOut"};return n.post(e,t,this.handle)},this.getDBVar=function(t,e,r){this.handle=function(t){return n.getNode(t,"value")};var i={dbid:t,action:"GetDBvar",params:{varname:e}};return n.post(i,r,this.handle)},this.setDBVar=function(t,e,r,i){this.handle=function(){return!0};var a={dbid:t,action:"SetDBvar",params:{varname:e,value:r}};return n.post(a,i,this.handle)},this.uploadPage=function(t,e,r,i,a){this.handle=function(t){return n.getNode(t,"pageID")};var o={pagetype:"1",pagebody:i};e?o.pageid=e:r&&(o.pagename=r);var s={dbid:t,action:"AddReplaceDBPage",params:o};return n.post(s,a,this.handle)},this.deletePage=function(t,e,r){this.handle=function(t){var e=n.getNode(t,"errcode");return"0"==e?!0:!1};var i={dbid:t,action:"PageDelete",type:"QBI",params:{pageid:e}};return n.post(i,r,this.handle)},this.getDbPage=function(t,e,r){this.handle=function(t){return n.getNode(t,"pagebody")};var i={dbid:t,action:"GetDBPage",type:"API",params:{pageID:e}};return n.post(i,r,this.handle)},this.cloneDatabase=function(t,e,r){this.handle=function(t){return n.getNode(t,"newdbid")};var i={dbid:t,action:"CloneDatabase",type:"API",params:e};return n.post(i,r,this.handle)},this.createDatabase=function(t,e,r,i){this.handle=function(t){return n.getNode(t,"dbid")};var a={dbid:"main",action:"CreateDatabase",type:"API",params:{dbname:t,dbdesc:e,createapptoken:r||!1}};return n.post(a,i,this.handle)},this.deleteDatabase=function(t,e){this.handle=function(t){var e=n.getNode(t,"errcode");return"0"==e?!0:!1};var r={dbid:t,action:"DeleteDatabase",type:"API"};return n.post(r,e,this.handle)},this.renameApp=function(t,e,r){this.handle=function(t){var e=n.getNode(t,"errcode");return"0"==e?!0:!1};var i={dbid:t,action:"RenameApp",type:"API",params:{newappname:e}};return n.post(i,r,this.handle)},this.findDbByName=function(t,e){this.handle=function(t){return n.getNode(t,"dbid")};var r={dbid:"main",action:"FindDBByName",type:"API",params:{dbname:t}};return n.post(r,e,this.handle)},this.getAncestorInfo=function(t,e){this.handle=function(t){var e={ancestorAppId:n.getNode(t,"ancestorappid"),oldestAncestorAppId:n.getNode(t,"oldestancestorappid")};return e};var r={dbid:t,action:"GetAncestorInfo",type:"API"};return n.post(r,e,this.handle)},this.getAppDtmInfo=function(t,e){this.handle=function(t){for(var e={},r=$(t).find("tables").find("table"),i=0;i<r.length;i++){var a=r[i],o={lastModifiedTime:$(a).find("lastModifiedTime").text(),lastRecModTime:$(a).find("lastRecModTime").text()};e[$(a).attr("id")]=o}var s={requestTime:n.getNode(t,"RequestTime"),requestNextAllowedTime:n.getNode(t,"RequestNextAllowedTime"),lastModifiedTime:n.getNode(t,"lastModifiedTime"),lastRecModTime:n.getNode(t,"lastRecModTime"),tables:e};return s};var r={dbid:"main",action:"GetAppDTMInfo",type:"API",params:{dbid:t}};return n.post(r,e,this.handle)},this.getDbInfo=function(t,e){this.handle=function(t){var e={dbname:n.getNode(t,"dbname"),lastRecModTime:n.getNode(t,"lastRecModTime"),createdTime:n.getNode(t,"createdTime"),numRecords:n.getNode(t,"numRecords"),mgrID:n.getNode(t,"mgrID"),mgrName:n.getNode(t,"mgrName"),version:n.getNode(t,"version"),time_zone:n.getNode(t,"time_zone")};return e};var r={dbid:t,action:"GetDBInfo",type:"API"};return n.post(r,e,this.handle)},this.grantedDbs=function(t,e){this.handle=function(t){for(var e=[],r=$(t).find("databases").find("dbinfo"),i=0;i<r.length;i++){var a=r[i],o={dbname:n.getNode(a,"dbname"),dbid:n.getNode(a,"dbid")};e.push(o)}return e};var r={dbid:"main",action:"GrantedDBs",type:"API",params:t};return n.post(r,e,this.handle)},this.doQuery=function(t,e,r,i){this.handle=function(t){return n.getRecords(t,"records")};var a={fmt:"structured"};e.query||e.qid?e.query?a.query=e.query:a.qid=e.qid:a.query="{'3'.XEX.''}",a.clist=e.clist||"a",a.slist=e.slist,a.options=e.options;var o={dbid:t,action:"DoQuery",params:a};return i&&(this.handle=i),n.post(o,r,this.handle)},this.doQueryCount=function(t,e,r){this.handle=function(t){return n.getNode(t,"numMatches")};var i={dbid:t,action:"DoQueryCount",params:{query:e}};return n.post(i,r,this.handle)},this.find=function(t,e,r){this.handle=function(t){var e=n.getRecords(t,"records");return e.length>0?e.length>1?e:e[0]:{}};var i=[];if("[object Array]"==Object.prototype.toString.call(e))for(var a=0;a<e.length;a++)i.push("{'3'.EX.'"+e[a]+"'}");else i.push("{'3'.EX.'"+e+"'}");return i=i.join("OR"),this.doQuery(t,{query:i},r,this.handle)},this.first=function(t,e,r){return this.handle=function(t){var e=n.getRecords(t,"records");return e.length>0?e[0]:{}},this.doQuery(t,e,r,this.handle)},this.last=function(t,e,r){return this.handle=function(t){var e=n.getRecords(t,"records");return e.length>0?e[e.length-1]:{}},this.doQuery(t,e,r,this.handle)},this.all=function(t,e,r){return this.handle=function(t){var e=n.getRecords(t,"records");return e.length>0?e:{}},e||(e={}),e.query="{'3'.XEX.''}",this.doQuery(t,e,r,this.handle)},this.getRids=function(t,e,r){return this.handle=function(t){return n.getRids(t)},e||(e={}),e.clist="3",this.doQuery(t,e,r,this.handle)},this.genAddRecordForm=function(t,e,r){this.handle=function(t){return t};var i={dbid:t,action:"GenAddRecordForm",fidParams:e};return n.post(i,r,this.handle)},this.getNumRecords=function(t,e){this.handle=function(t){return parseInt(n.getNode(t,"num_records"))};var r={dbid:t,action:"GetNumRecords"};return n.post(r,e,this.handle)},this.getRecordInfo=function(t,e,r){this.handle=function(t){for(var e={},r=$(t).find("field"),i=0;i<r.length;i++){var a=r[i],o={name:n.getNode(a,"name"),type:n.getNode(a,"type"),value:n.getNode(a,"value")};e[$(a).find("fid").text()]=o}var s={rid:n.getNode(t,"rid"),num_fields:n.getNode(t,"num_fields"),update_id:n.getNode(t,"update_id"),fields:e};return s};var i={dbid:t,action:"GetRecordInfo",params:{rid:e}};return n.post(i,r,this.handle)},this.importFromCSV=function(t,e,r){this.handle=function(t){return n.getNewRids(t)};var i="",a=[];for(key in e[0])a.push(key);a=a.join(".");for(var o=0;o<e.length;o++){var s=e[o],d=[];for(key in s)value=s[key],value=value.toString().replace(/"/g,'""'),d.push('"'+value+'"');d.join(","),d+="\n",i+=d}var c={dbid:t,action:"ImportFromCSV",params:{clist:a},csvData:i};return n.post(c,r,this.handle)},this.addRecord=function(t,e,r){this.handle=function(t){return parseInt(n.getNode(t,"rid"))};var i={dbid:t,action:"AddRecord",fieldParams:e};return n.post(i,r,this.handle)},this.editRecord=function(t,e,r,i){this.handle=function(t){var e=n.getNode(t,"rid");return e?!0:!1};var a={dbid:t,action:"EditRecord",fieldParams:r,params:{rid:e}};return n.post(a,i,this.handle)},this.changeRecordOwner=function(t,e,r,i){this.handle=function(){return!0};var a={dbid:t,action:"ChangeRecordOwner",params:{rid:e,newowner:r}};return n.post(a,i,this.handle)},this.copyMasterDetail=function(t,e,r){this.handle=function(t){return n.getNode(t,"numCreated")};var i={dbid:t,action:"CopyMasterDetail",params:e};return n.post(i,r,this.handle)},this.deleteRecord=function(t,e,r){this.handle=function(t){var e=n.getNode(t,"rid");return e?!0:!1};var i={dbid:t,action:"DeleteRecord",params:{rid:e}};return n.post(i,r,this.handle)},this.purgeRecords=function(t,e,r){this.handle=function(t){var e=n.getNode(t,"num_records_deleted");return parseInt(e)};var i={dbid:t,action:"PurgeRecords",params:{query:e}};return n.post(i,r,this.handle)},this.setFieldProperties=function(t,e,r,i){this.handle=function(t){var e=n.getNode(t,"errcode");return 0==e?!0:!1},r.fid=e;var a={dbid:t,action:"SetFieldProperties",params:r};return n.post(a,i,this.handle)},this.getUserInfo=function(t,e){this.handle=function(t){var e=$(t).find("user");return e={id:$(e).attr("id"),firstName:$(e).find("firstName").text(),lastName:$(e).find("lastName").text(),login:$(e).find("login").text(),email:$(e).find("email").text(),screenName:$(e).find("screenName").text(),isVerified:$(e).find("isVerified").text(),externalAuth:$(e).find("externalAuth").text()}},t||(t="");var r={dbid:"main",action:"GetUserInfo",params:{email:t}};return n.post(r,e,this.handle)},this.getUserRoles=function(t,e){this.handle=function(t){return n.formatUserRoles(t)};var r={dbid:t,action:"UserRoles"};return n.post(r,e,this.handle)},this.changeUserRole=function(t,e,r,i,a){this.handle=function(){return!0};var o={dbid:t,action:"ChangeUserRole",params:{userId:e,roleId:r}};return i&&(o.params.newRoleId=i),n.post(o,a,this.handle)},this.getTableFields=function(t,e){this.handle=function(t){return n.getFields(t)};var r={dbid:t,action:"GetSchema"};return n.post(r,e,this.handle)},this.getTableReports=function(t,e){this.handle=function(t){return n.getReports(t)};var r={dbid:t,action:"GetSchema"};return n.post(r,e,this.handle)}}var BaseHelpers={options:{timeZone:"utc",format:"hours"},getUrlParam:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=e.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},formatDateElement:function(t){return t=t.toString(),1==t.length&&(t="0"+t),t},dateToString:function(t){if(t){var e=new Date(parseInt(t)),n=this.formatDateElement(e.getUTCMonth()+1),r=this.formatDateElement(e.getUTCDate());return e=[n,r,e.getUTCFullYear()].join("-")}return" "},dateTimeToString:function(t,e){var n=new Date,e=e?e.toLowerCase().trim():this.options.timeZone.toLowerCase();Date.prototype.stdTimezoneOffset=function(){var t=new Date(this.getFullYear(),0,1),e=new Date(this.getFullYear(),6,1);return Math.max(t.getTimezoneOffset(),e.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};var r={utc:0,eastern:n.dst()?-4:-5,central:n.dst()?-5:-6,mountain:n.dst()?-6:-7,pacific:n.dst()?-7:-8},i=r[e];if(t){var a=new Date(parseInt(t)+36e5*i),o=(this.formatDateElement(a.getUTCFullYear),this.formatDateElement(a.getUTCMonth()+1)),s=this.formatDateElement(a.getUTCDate()),d=this.formatDateElement(a.getUTCHours()),c=this.formatDateElement(a.getUTCMinutes()),u=(this.formatDateElement(a.getUTCSeconds()),[o,s,a.getUTCFullYear()].join("-")),h=parseInt(d)>=12?"PM":"AM";return d%=12,d=d?d:12,u+=" ",u+=[d,c].join(":"),u+=" "+h}return""},durationToString:function(t,e){var n,r=parseInt(t),e=e?e.trim().toLowerCase():this.options.format.toLowerCase(),i={days:function(){return r/864e5},hours:function(){return r/36e5},minutes:function(){return r/6e4},seconds:function(){return r/1e3}};return t?(i[e]?n=i[e]():(n=i.hours(),console.info("The format parameter passed to BaseHelpers.durationToString() was incorrect. Using the format for 'hours' instead.")),n=Math.round(100*n)/100,n.toString()):""},timeOfDayToString:function(t){var e="";e=new Date,e.setHours(""),e.setMinutes(""),e.setSeconds(""),e.setMilliseconds(t);var n=e.getHours().toString(),r=e.getMinutes().toString(),i=n>12?"pm":"am";return n%=12,n=n?n:12,r=r.length>1?r:"0"+r,e=n+":"+r+" "+i},redirectToEditForm:function(t,e){window.location="/db/"+t+"?a=er&rid="+e},redirectToViewForm:function(t,e){window.location="/db/"+t+"?a=dr&rid="+e},downloadFile:function(t,e,n,r){var r=r||0;window.location="https://www.quickbase.com/up/"+t+"/a/r"+e+"/e"+n+"/v"+r}};