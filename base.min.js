function BaseConnect(){this.apptoken=null;this.async=null;this.post=function(e,t,n){var r=e.type||"API";var i=r+"_"+e.action;var s=this.buildPostData(e);return this.xmlPost(e.dbid,i,s,t,n)};this.buildPostData=function(e){var t=["<qdbapi>"];if(this.apptoken){t.push(this.createParameter("apptoken",this.apptoken))}for(key in e.params){var n=e.params[key];if(key=="clist"||key=="slist"||key=="options"){if(Object.prototype.toString.call(n)=="[object Array]"){n=n.join(".")}}if(n){t.push(this.createParameter(key,n))}}for(key in e.fieldParams){t.push(this.createFieldParameter(key,e.fieldParams[key]))}if(e.csvData){t.push(this.createCSVParameter(e.csvData))}t.push("</qdbapi>");return t.join("")};this.getNode=function(e,t){return $(e).find(t).text()};this.getRecords=function(e){var t=$(e).find("records").find("record");var n=[];for(var r=0;r<t.length;r++){var i=t[r];var s=$(i).find("f");i={};for(var o=0;o<s.length;o++){var u=s[o];var a=parseInt($(u).attr("id"));if($(u).find("url").text()!=""){var f=$(u).find("url").text();var l=f.split("/");var c=l[l.length-1];var h={filename:c,url:f}}else{var h=$(u).text()}i[a]=h}n.push(i)}return n};this.getRids=function(e){var t=$(e).find("records").find("record");var n=[];for(var r=0;r<t.length;r++){var i=t[r];n.push($(i).find('f[id="3"]').text())}return n};this.getNewRids=function(e){var t=$(e).find("rids").find("rid");var n=[];for(var r=0;r<t.length;r++){var i=parseInt($(t[r]).text());n.push(i)}return n};this.getFields=function(e){var t=$(e).find("fields").find("field");var n={};for(var r=0;r<t.length;r++){var i=t[r];var s={label:$(i).find("label").text(),nowrap:$(i).find("nowrap").text(),bold:$(i).find("bold").text(),required:$(i).find("required").text(),appears_by_default:$(i).find("appears_by_default").text(),find_enabled:$(i).find("find_enabled").text(),allow_new_choices:$(i).find("allow_new_choices").text(),sort_as_given:$(i).find("sort_as_given").text(),carrychoices:$(i).find("carrychoices").text(),foreignkey:$(i).find("foreignkey").text(),unique:$(i).find("unique").text(),doesdatacopy:$(i).find("doesdatacopy").text(),fieldhelp:$(i).find("fieldhelp").text(),display_user:$(i).find("display_user").text(),default_kind:$(i).find("default_kind").text()};n[$(i).attr("id")]=s}return n};this.getReports=function(e){var t=$(e).find("queries").find("query");var n={};for(var r=0;r<t.length;r++){var i=t[r];var s={name:$(i).find("qyname").text(),type:$(i).find("qytype").text(),criteria:$(i).find("qycrit").text(),clist:$(i).find("qyclst").text(),slist:$(i).find("qyslst").text(),options:$(i).find("qyopts").text()};n[$(i).attr("id")]=s}return n};this.formatUserRoles=function(e){var t=$(e).find("users").find("user");var n=[];for(var r=0;r<t.length;r++){var i=t[r];var s=$(i).find("roles").find("role");var o=[];for(var u=0;u<s.length;u++){var a=s[u];var f={id:$(a).attr("id"),name:$(a).find("name").text(),accessId:$(a).find("access").attr("id"),access:$(a).find("access").text()};o.push(f)}var l={id:$(i).attr("id"),firstName:$(i).find("firstName").text(),lastName:$(i).find("lastName").text(),lastAccess:$(i).find("lastAccess").text(),lastAccessAppLocal:$(i).find("lastAccessAppLocal").text(),roles:o};n.push(l)}return n};this.createParameter=function(e,t){return"<"+e+">"+t+"</"+e+">"};this.createFieldParameter=function(e,t){var n="<field fid='"+e+"'";if(t){if(t.filename){n+=" filename='"+t.filename+"'>";n+=this.base64Encode(t.body)}else{n+=">";n+=t}}n+="</field>";return n};this.createCSVParameter=function(e){return"<records_csv><![CDATA["+e+"]]></records_csv>"};this.base64Encode=function(e){var t="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var r,i,s,o,u,a,f;var l=0;var c=e.replace(/\r\n/g,"\n");var h="";for(var p=0;p<c.length;p++){var d=c.charCodeAt(p);if(d<128){h+=String.fromCharCode(d)}else if(d>127&&d<2048){h+=String.fromCharCode(d>>6|192);h+=String.fromCharCode(d&63|128)}else{h+=String.fromCharCode(d>>12|224);h+=String.fromCharCode(d>>6&63|128);h+=String.fromCharCode(d&63|128)}}e=h;while(l<e.length){r=e.charCodeAt(l++);i=e.charCodeAt(l++);s=e.charCodeAt(l++);o=r>>2;u=(r&3)<<4|i>>4;a=(i&15)<<2|s>>6;f=s&63;if(isNaN(i)){a=f=64}else if(isNaN(s)){f=64}t=t+n.charAt(o)+n.charAt(u)+n.charAt(a)+n.charAt(f)}return t};this.xmlPost=function(e,t,n,r,i){var s="/db/"+e+"?act="+t;if(this.async){$.ajax({url:s,type:"POST",context:this,contentType:"text/xml",data:n,dataType:"xml",success:function(e){return r(i(e))}})}else{var o=null;$.ajax({url:s,type:"POST",context:this,contentType:"text/xml",data:n,dataType:"xml",async:false,success:function(e){o=i(e)}});return o}};this.parseResponse=function(e){var t=this.getNode(e,"errcode");if(t!="0"){console.log("*****ERROR*****: ("+this.getNode(e,"action")+")"+"(CODE: "+t+")","MESSAGE: "+this.getNode(e,"errtext")+" - "+this.getNode(e,"errdetail"))}this.ticket=this.getNode(e,"ticket");return e};this.setVariables=function(e,t){this.apptoken=e;this.async=t||false};this.initHttpConnection=function(e){var t=null;this.context=e;try{if(!t){t=new XMLHttpRequest}}catch(n){}try{if(!t){t=new ActiveXObject("Msxml2.XMLHTTP")}}catch(n){}try{if(!t){t=new ActiveXObject("Microsoft.XMLHTTP")}}catch(n){alert("This browser does not support BaseJS.")}return t}}function Base(e,t){var n=new BaseConnect;n.setVariables(e,t);this.getTicket=function(e){this.handle=function(e){return n.getNode(e,"ticket")};var t={dbid:"main",action:"GetOneTimeTicket"};return n.post(t,e,this.handle)};this.getDBVar=function(e,t,r){this.handle=function(e){return n.getNode(e,"value")};var i={dbid:e,action:"GetDBvar",params:{varname:t}};return n.post(i,r,this.handle)};this.setDBVar=function(e,t,r,i){this.handle=function(e){return true};var s={dbid:e,action:"SetDBvar",params:{varname:t,value:r}};return n.post(s,i,this.handle)};this.uploadPage=function(e,t,r,i,s){this.handle=function(e){return n.getNode(e,"pageID")};var o={pagetype:"1",pagebody:i};if(t){o["pageid"]=t}else if(r){o["pagename"]=r}var u={dbid:e,action:"AddReplaceDBPage",params:o};return n.post(u,s,this.handle)};this.deletePage=function(e,t,r){this.handle=function(e){var t=n.getNode(e,"errcode");if(t=="0"){return true}else{return false}};var i={dbid:e,action:"PageDelete",type:"QBI",params:{pageid:t}};return n.post(i,r,this.handle)};this.doQuery=function(e,t,r,i){this.handle=function(e){return n.getRecords(e,"records")};var s={fmt:"structured"};if(t.query||t.qid){if(t.query){s.query=t.query}else{s.qid=t.qid}}else{s.query="{'3'.XEX.''}"}s.clist=t.clist||"a";s.slist=t.slist;s.options=t.options;var o={dbid:e,action:"DoQuery",params:s};if(i){this.handle=i}return n.post(o,r,this.handle)};this.doQueryCount=function(e,t,r){this.handle=function(e){return n.getNode(e,"numMatches")};var i={dbid:e,action:"DoQueryCount",params:{query:t}};return n.post(i,r,this.handle)};this.find=function(e,t,r){this.handle=function(e){var t=n.getRecords(e,"records");if(t.length>0){if(t.length>1){return t}else{return t[0]}}else{return{}}};var i=[];if(Object.prototype.toString.call(t)=="[object Array]"){for(var s=0;s<t.length;s++){i.push("{'3'.EX.'"+t[s]+"'}")}}else{i.push("{'3'.EX.'"+t+"'}")}i=i.join("OR");return this.doQuery(e,{query:i},r,this.handle)};this.first=function(e,t,r){this.handle=function(e){var t=n.getRecords(e,"records");if(t.length>0){return t[0]}else{return{}}};return this.doQuery(e,t,r,this.handle)};this.last=function(e,t,r){this.handle=function(e){var t=n.getRecords(e,"records");if(t.length>0){return t[t.length-1]}else{return{}}};return this.doQuery(e,t,r,this.handle)};this.all=function(e,t,r){this.handle=function(e){var t=n.getRecords(e,"records");if(t.length>0){return t}else{return{}}};if(!t){t={}}t["query"]="{'3'.XEX.''}";return this.doQuery(e,t,r,this.handle)};this.getRids=function(e,t,r){this.handle=function(e){return n.getRids(e)};if(!t){t={}}t["clist"]="3";return this.doQuery(e,t,r,this.handle)};this.importFromCSV=function(e,t,r){this.handle=function(e){return n.getNewRids(e)};var i="";var s=[];for(key in t[0]){s.push(key)}s=s.join(".");for(var o=0;o<t.length;o++){var u=t[o];var a=[];for(key in u){value=u[key];value=value.toString().replace(/"/g,'""');a.push('"'+value+'"')}a.join(",");a+="\n";i+=a}var f={dbid:e,action:"ImportFromCSV",params:{clist:s},csvData:i};return n.post(f,r,this.handle)};this.addRecord=function(e,t,r){this.handle=function(e){return parseInt(n.getNode(e,"rid"))};var i={dbid:e,action:"AddRecord",fieldParams:t};return n.post(i,r,this.handle)};this.editRecord=function(e,t,r,i){this.handle=function(e){var t=n.getNode(e,"rid");if(t){return true}else{return false}};var s={dbid:e,action:"EditRecord",fieldParams:r,params:{rid:t}};return n.post(s,i,this.handle)};this.copyMasterDetail=function(e,t,r){this.handle=function(e){return n.getNode(e,"numCreated")};var i={dbid:e,action:"CopyMasterDetail",params:t};return n.post(i,r,this.handle)};this.deleteRecord=function(e,t,r){this.handle=function(e){var t=n.getNode(e,"rid");if(t){return true}else{return false}};var i={dbid:e,action:"DeleteRecord",params:{rid:t}};return n.post(i,r,this.handle)};this.purgeRecords=function(e,t,r){this.handle=function(e){var t=n.getNode(e,"num_records_deleted");return parseInt(t)};var i={dbid:e,action:"PurgeRecords",params:{query:t}};return n.post(i,r,this.handle)};this.getUserInfo=function(e,t,r){this.handle=function(e){var t=$(e).find("user");t={id:$(t).attr("id"),firstName:$(t).find("firstName").text(),lastName:$(t).find("lastName").text(),login:$(t).find("login").text(),email:$(t).find("email").text(),screenName:$(t).find("screenName").text(),isVerified:$(t).find("isVerified").text(),externalAuth:$(t).find("externalAuth").text()};return t};if(!e){e=""}var i={dbid:"main",action:"GetUserInfo",params:{email:e}};return n.post(i,t,this.handle)};this.getUserRoles=function(e,t){this.handle=function(e){return n.formatUserRoles(e)};var r={dbid:e,action:"UserRoles"};return n.post(r,t,this.handle)};this.changeUserRole=function(e,t,r,i,s){this.handle=function(e){return true};var o={dbid:e,action:"ChangeUserRole",params:{userId:t,roleId:r}};if(i){o["params"]["newRoleId"]=i}return n.post(o,s,this.handle)};this.getRecordInfo=function(e,t,r){this.handle=function(e){var t=$(e).find("field");var n={};for(var r=0;r<t.length;r++){var i=t[r];n[$(i).find("fid").text()]=$(i).find("value").text()}return n};var i={dbid:e,action:"GetRecordInfo",params:{rid:t}};return n.post(i,r,this.handle)};this.getTableFields=function(e,t){this.handle=function(e){return n.getFields(e)};var r={dbid:e,action:"GetSchema"};return n.post(r,t,this.handle)};this.getTableReports=function(e,t){this.handle=function(e){return n.getReports(e)};var r={dbid:e,action:"GetSchema"};return n.post(r,t,this.handle)}}var BaseHelpers={getUrlParam:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\+/g," "))},formatDateElement:function(e){e=e.toString();if(e.length==1){e="0"+e}return e},dateToString:function(e){if(e){var t=new Date(parseInt(e));var n=this.formatDateElement(t.getUTCMonth()+1);var r=this.formatDateElement(t.getUTCDate());t=[n,r,t.getUTCFullYear()].join("-");return t}return e},dateTimeToString:function(e){if(e){var t=new Date(parseInt(e));var n=this.formatDateElement(t.getUTCMonth()+1);var r=this.formatDateElement(t.getUTCDate());var i=this.formatDateElement(t.getUTCHours());var s=this.formatDateElement(t.getUTCMinutes());var o=this.formatDateElement(t.getUTCSeconds());var u=[n,r,t.getUTCFullYear()].join("-");var a=parseInt(i)>=12?"pm":"am";i=i%12;i=i?i:12;u+=" ";u+=[i,s].join(":");u+=" "+a;return u}return e},durationToString:function(e){var t="0";if(e){t=parseInt(e)/36e5}return t.toString()+" hours"},timeOfDayToString:function(e){var t="";if(e){t=(new Date).setHours("").setMinutes("").setSeconds("");t=t.setMilliseconds(e);t=new Date(t);var n=parseInt(t.getHours());var r=t.getMinutes().toString();var i="am";if(n>=12){i="pm";if(n>12){n=n-12}}if(r.length==1){r="0"+r}t=n.toString()+":"+r+" "+i}return t},redirectToEditForm:function(e,t){window.location="/db/"+e+"?a=er&rid="+t},redirectToViewForm:function(e,t){window.location="/db/"+e+"?a=dr&rid="+t},downloadFile:function(e,t,n,r){var r=r||0;window.location="https://www.quickbase.com/up/"+e+"/a/r"+t+"/e"+n+"/v"+r}}